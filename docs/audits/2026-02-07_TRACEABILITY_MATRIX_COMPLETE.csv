Rule ID,Rule Description,Source,Status,Technical Trace (Class::Method),Canonical Notebook Reference,Module,Severity (if gap),Code Location,Notes
P-01,No Modification Frozen: Cannot modify budget when CONGELADO,Canonical,ðŸŸ¡ Partial,Presupuesto::congelar(),PRESUPUESTO_MODULE_CANONICAL.md,Presupuesto,CRITICAL,backend/src/main/java/com/budgetpro/domain/finanzas/presupuesto/Presupuesto.java,Entity enforces but CrearPartidaUseCaseImpl bypasses
P-02,WBS Hierarchy: Must maintain tree structure,Canonical,âœ… Verified,Presupuesto (aggregate root),PRESUPUESTO_MODULE_CANONICAL.md,Presupuesto,,backend/src/main/java/com/budgetpro/domain/finanzas/presupuesto/Presupuesto.java,Correctly implemented
P-03,Leaf Node APU: Only leaf partidas can have APU,Canonical,ðŸ”´ Missing,PartidaPresupuestaria::agregarAPU,PRESUPUESTO_MODULE_CANONICAL.md,Presupuesto,HIGH,backend/src/main/java/com/budgetpro/domain/finanzas/presupuesto/PartidaPresupuestaria.java,No isHoja() check before APU creation
P-04,Snapshot Immutability: APUSnapshot cannot change except rendimiento,Canonical,âœ… Verified,APUSnapshot (final fields),PRESUPUESTO_MODULE_CANONICAL.md,Presupuesto,,backend/src/main/java/com/budgetpro/domain/finanzas/presupuesto/APUSnapshot.java,Correctly immutable
P-05,Unique Item Code: Each partida unique WBS code within project,Canonical,ðŸ”´ Missing,CrearPartidaUseCaseImpl,PRESUPUESTO_MODULE_CANONICAL.md,Presupuesto,MEDIUM,backend/src/main/java/com/budgetpro/application/presupuesto/CrearPartidaUseCaseImpl.java,Uniqueness check absent
P-06,Indirect Cost Formulas: Percentage-based calculation,Canonical,âœ… Verified,Presupuesto::calcularCostosIndirectos,PRESUPUESTO_MODULE_CANONICAL.md,Presupuesto,,backend/src/main/java/com/budgetpro/domain/finanzas/presupuesto/Presupuesto.java,Formula correctly implemented
ES-01,Sequential Approval: Estimations must be approved in strict order,Canonical,ðŸ”´ MISSING,AprobarEstimacionUseCaseImpl,ESTIMACION_MODULE_CANONICAL.md,Estimacion,CRITICAL,backend/src/main/java/com/budgetpro/application/estimacion/AprobarEstimacionUseCaseImpl.java,NO sequence check implemented
ES-02,Wallet Impact: Approval triggers ingress in Project Wallet,Canonical,ðŸŸ¡ Partial,AprobarEstimacionUseCaseImpl,ESTIMACION_MODULE_CANONICAL.md,Estimacion,HIGH,backend/src/main/java/com/budgetpro/application/estimacion/AprobarEstimacionUseCaseImpl.java,Only registers amortization; no AP generation
ES-03,Non-Negative Payment: Payment cannot be negative,Canonical,ðŸŸ¡ Partial,Estimacion::calcularPagoNeto,ESTIMACION_MODULE_CANONICAL.md,Estimacion,MEDIUM,backend/src/main/java/com/budgetpro/domain/finanzas/estimacion/Estimacion.java,Check exists but calculation loophole
ES-04,Advance Amortization: Amortize against previous advances,Canonical,ðŸŸ¡ Partial,GeneradorEstimacionService,ESTIMACION_MODULE_CANONICAL.md,Estimacion,MEDIUM,backend/src/main/java/com/budgetpro/domain/finanzas/estimacion/GeneradorEstimacionService.java,Partial implementation; formula missing
C-01,Program Frozen: Program frozen when budget approved,Canonical,âœ… Verified,ProgramaObra::actualizarFechas,CRONOGRAMA_MODULE_CANONICAL.md,Cronograma,,backend/src/main/java/com/budgetpro/domain/finanzas/cronograma/ProgramaObra.java,Correctly enforces baseline freeze
C-02,Dependency Integrity: No circular dependencies,Canonical,ðŸŸ¡ Partial,CalculoCronograma,CRONOGRAMA_MODULE_CANONICAL.md,Cronograma,HIGH,backend/src/main/java/com/budgetpro/domain/finanzas/cronograma/CalculoCronograma.java,Basic check; missing Kahn's algorithm
C-03,One Activity Per Leaf: Leaf partidas require activity,Canonical,âœ… Verified,ActividadProgramada::partidaId,CRONOGRAMA_MODULE_CANONICAL.md,Cronograma,,backend/src/main/java/com/budgetpro/domain/finanzas/cronograma/ActividadProgramada.java,Correctly implemented
C-04,Working Days: Duration based on project calendar,Canonical,ðŸ”´ Missing,CalculoCronogramaService,CRONOGRAMA_MODULE_CANONICAL.md,Cronograma,HIGH,backend/src/main/java/com/budgetpro/domain/finanzas/cronograma/CalculoCronogramaService.java,Uses ChronoUnit.DAYS (calendar days)
C-05,Temporal Consistency: End date >= Start date,Code,âœ… Verified,ProgramaObra::validarInvariantes,Not documented,Cronograma,,-,Discovered during audit
C-06,Self-Dependency Prevention: Activity cannot depend on itself,Code,âœ… Verified,ActividadProgramada::validarInvariantes,Not documented,Cronograma,,-,Discovered during audit
C-07,Financing Duration Logic: Duration calculation for financing,Code,âœ… Verified,CalculoCronogramaService,Not documented,Cronograma,,-,Discovered during audit
C-08,Freeze Metadata Auditing: Tracks baseline creation,Code,âœ… Verified,ProgramaObra::congelar,Not documented,Cronograma,,-,Discovered during audit
B-01,Non-Negative Balance: Wallet balance cannot be negative,Canonical,âœ… Verified,Billetera::egresar,BILLETERA_MODULE_CANONICAL.md,Billetera,,backend/src/main/java/com/budgetpro/domain/finanzas/billetera/Billetera.java,Correctly enforced with exception
B-02,Audit Trail: Every movement has source reference,Canonical,âœ… Verified,Billetera (append-only list),BILLETERA_MODULE_CANONICAL.md,Billetera,,backend/src/main/java/com/budgetpro/domain/finanzas/billetera/Billetera.java,Immutable movement list
B-03,Currency Mix: Cannot mix currencies in same wallet,Canonical,âœ… Verified,Billetera::ingresar/egresar,BILLETERA_MODULE_CANONICAL.md,Billetera,,backend/src/main/java/com/budgetpro/domain/finanzas/billetera/Billetera.java,Validated on operations
B-04,Evidence Lock: Max 3 pending movements without evidence,Code,âœ… Verified,Billetera::contarMovimientosPendientesEvidencia,Not documented,Billetera,HIGH,-,Discovered during audit; blocks 4th operation
B-05,Cryptographic Integrity: Budget hash validated before egress,Code,âœ… Verified,Billetera::egresar (integrity check),Not documented,Billetera,HIGH,-,Discovered during audit; critical for financial security
B-06,Amount Positivity: Movement amounts must be > 0,Code,âœ… Verified,MovimientoCaja::validarInvariantes,Not documented,Billetera,,-,Discovered during audit
B-07,Currency ISO Format: Currency must be ISO-4217 3-char,Code,âœ… Verified,MovimientoCaja::validarInvariantes,Not documented,Billetera,,-,Discovered during audit
B-08,Reference Obligation: Movement must have source reference,Code,âœ… Verified,MovimientoCaja::validarInvariantes,Not documented,Billetera,,-,Discovered during audit
R-01,Civil Construction Labor Regime: Regime caps and rules,Canonical,ðŸŸ¡ Partial,ConfiguracionLaboralExtendida,RRHH_MODULE_CANONICAL.md,RRHH,CRITICAL,backend/src/main/java/com/budgetpro/domain/rrhh/ConfiguracionLaboralExtendida.java,Factors defined but capping logic missing
R-02,No Attendance Inactive: Cannot register attendance for inactive workers,Canonical,ðŸ”´ Missing,AsistenciaRegistro::registrar,RRHH_MODULE_CANONICAL.md,RRHH,HIGH,backend/src/main/java/com/budgetpro/domain/rrhh/AsistenciaRegistro.java,Doesn't check Empleado.estado
R-03,Double Booking Prevention: Worker cannot be in two places,Canonical,âœ… Verified,AsistenciaRegistro::detectOverlap,RRHH_MODULE_CANONICAL.md,RRHH,,backend/src/main/java/com/budgetpro/domain/rrhh/AsistenciaRegistro.java,Correctly implemented
R-04,Config Integrity: Non-negative days and positive factors,Code,âœ… Verified,ConfiguracionLaboralExtendida::validarInvariantes,Not documented,RRHH,,-,Discovered during audit
R-05,Social Security Cap: SS percentage 0-100%,Code,âœ… Verified,ConfiguracionLaboralExtendida::validarInvariantes,Not documented,RRHH,,-,Discovered during audit
R-06,Employee Reference Integrity: Valid ID name lastname status,Code,âœ… Verified,Empleado::validarInvariantes,Not documented,RRHH,,-,Discovered during audit
R-07,History Continuity: New condition date >= current start,Code,âœ… Verified,Empleado::actualizarCondicionesLaborales,Not documented,RRHH,,-,Discovered during audit
R-08,Overnight Shift Logic: Exit < Entry = overnight,Code,âœ… Verified,AsistenciaRegistro::esOvernight,Not documented,RRHH,,-,Discovered during audit
R-09,FSR Calculation: FSR = (Total Paid / Total Worked) + SS Factor,Code,âœ… Verified,CalculadorFSR,Not documented,RRHH,,-,Discovered during audit
R-10,Config Closure: Closing date >= start date,Code,âœ… Verified,ConfiguracionLaboralExtendida::cerrar,Not documented,RRHH,,-,Discovered during audit
L-01,Budget Check: Cannot purchase if budget unavailable,Canonical,âœ… Verified,ProcesarCompraService::getSaldoDisponible,COMPRAS_MODULE_CANONICAL.md,Compras,,backend/src/main/java/com/budgetpro/application/compras/ProcesarCompraService.java,Strictly enforced
L-02,Price Independence: Purchase prices decoupled from APU,Canonical,âœ… Verified,Compra::precio,COMPRAS_MODULE_CANONICAL.md,Compras,,backend/src/main/java/com/budgetpro/domain/compras/Compra.java,Correctly decoupled
L-03,Stock Updates: Purchase triggers inventory update,Canonical,ðŸŸ¡ Partial,ProcesarCompraService::registrarEntradaPorCompra,COMPRAS_MODULE_CANONICAL.md,Compras,MEDIUM,backend/src/main/java/com/budgetpro/application/compras/ProcesarCompraService.java,Only on state RECIBIDA
L-04,Valid Provider: Provider must exist in directory,Canonical,ðŸ”´ Missing,ProcesarCompraService::normalizarProveedor,COMPRAS_MODULE_CANONICAL.md,Compras,LOW,backend/src/main/java/com/budgetpro/application/compras/ProcesarCompraService.java,Currently String field (technical debt)
I-01,No Negative Stock: Stock quantity cannot be negative,Canonical,âœ… Verified,InventarioItem::validarInvariantes,INVENTARIO_MODULE_CANONICAL.md,Inventario,,backend/src/main/java/com/budgetpro/domain/inventario/InventarioItem.java,Enforced in constructor egress adjust
I-02,Average Cost Update: Weighted average PMP calculation,Canonical,âœ… Verified,InventarioItem::ingresar,INVENTARIO_MODULE_CANONICAL.md,Inventario,,backend/src/main/java/com/budgetpro/domain/inventario/InventarioItem.java,Standard PMP formula
I-03,FIFO Support: First-in-first-out inventory policy,Canonical,ðŸ”´ Missing,InventarioItem,INVENTARIO_MODULE_CANONICAL.md,Inventario,MEDIUM,backend/src/main/java/com/budgetpro/domain/inventario/InventarioItem.java,Only PMP; no batch tracking
E-01,Metrado Cap: Progress cannot exceed budget quantity,Canonical,ðŸŸ¡ Soft,ControlAvanceService::registrarAvance,EVM_MODULE_CANONICAL.md,EVM,HIGH,backend/src/main/java/com/budgetpro/application/evm/ControlAvanceService.java,Prints WARNING only (soft governance)
E-02,Date Constraint: No future progress dates,Canonical,ðŸŸ¡ Partial,AvanceFisico::validarInvariantes,EVM_MODULE_CANONICAL.md,EVM,MEDIUM,backend/src/main/java/com/budgetpro/domain/evm/AvanceFisico.java,Missing explicit check
E-03,Active Project: Only active projects can log progress,Canonical,ðŸ”´ Missing,ControlAvanceService::registrarAvance,EVM_MODULE_CANONICAL.md,EVM,HIGH,backend/src/main/java/com/budgetpro/application/evm/ControlAvanceService.java,Doesn't check project status
E-04,Period Consistency: Align with reporting periods,Canonical,ðŸ”´ Missing,Valuacion,EVM_MODULE_CANONICAL.md,EVM,MEDIUM,backend/src/main/java/com/budgetpro/domain/evm/Valuacion.java,No period alignment logic
E-05,EV Cap: Earned Value cannot exceed BAC,Code,âœ… Verified,EVMSnapshot::validarInvariantes,Not documented,EVM,,-,Discovered during audit
E-06,Positive Progress: Executed metrado cannot be negative,Code,âœ… Verified,AvanceFisico::validarInvariantes,Not documented,EVM,,-,Discovered during audit
E-07,Valuation Immutability: Approved valuations cannot be modified,Code,âœ… Verified,Valuacion::aprobar,Not documented,EVM,,-,Discovered during audit
E-08,Valuation Code Normalization: Trim and uppercase code,Code,âœ… Verified,Valuacion::validarInvariantes,Not documented,EVM,,-,Discovered during audit
E-09,Snapshot Integrity: PV EV AC BAC must be non-null,Code,âœ… Verified,EVMSnapshot::validarInvariantes,Not documented,EVM,,-,Discovered during audit
X-01,Hexagonal Purity: Domain depends on nothing,Canonical,âœ… Verified,shared.port.out interfaces,CROSS_CUTTING_MODULE_CANONICAL.md,Cross-Cutting,,backend/src/main/java/com/budgetpro/domain/shared/port,-,Architecture correctly implemented
X-02,Fail-Fast Validation: Invariants checked in constructors,Canonical,âœ… Verified,All domain entities::validarInvariantes,CROSS_CUTTING_MODULE_CANONICAL.md,Cross-Cutting,,backend/src/main/java/com/budgetpro/domain,-,Consistently applied
X-03,Auditability: User ID tracked in all mutations,Canonical,ðŸŸ¡ Partial,AuditableEntity implementations,CROSS_CUTTING_MODULE_CANONICAL.md,Cross-Cutting,LOW,backend/src/main/java/com/budgetpro/domain,-,Ad-hoc; not consistently AOP-enforced
X-04,JWT Secret Strength: Secret >= 32 characters,Code,âœ… Verified,JwtService::validarInvariantes,Not documented,Cross-Cutting,,-,Discovered during audit
X-05,Stateless Auth Policy: No session state,Code,âœ… Verified,SecurityConfig::sessionManagement,Not documented,Cross-Cutting,,-,Discovered during audit
X-06,CORS Whitelist: Specific origins and methods only,Code,âœ… Verified,SecurityConfig::corsConfigurationSource,Not documented,Cross-Cutting,,-,Discovered during audit
X-07,Public Endpoint Whitelist: Explicit public API list,Code,âœ… Verified,SecurityConfig::authorizeHttpRequests,Not documented,Cross-Cutting,,-,Discovered during audit
