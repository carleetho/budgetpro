# ============================================================================
# Semgrep Configuration - Main Branch Context
# ============================================================================
#
# This configuration is used when scanning code on the main branch.
# It enforces the same strict quality gates as PR context, plus generates
# comprehensive reports for GitHub Code Scanning and metrics collection.
#
# Usage:
#   semgrep scan --config .semgrep/rules/ --config .semgrep/config/main.yaml \
#     --sarif --output findings.sarif .
#
# Enforcement Policy:
#   - ERROR severity: BLOCKS push to main (exit code 1)
#   - WARNING severity: Logged but ALLOWS push (exit code 0)
#   - INFO severity: Informational only
#
# Outputs:
#   - SARIF: For GitHub Code Scanning integration
#   - JSON: For metrics and trend analysis
#   - Text: For human-readable reports
#
# Integration:
#   - GitHub Actions: .github/workflows/semgrep.yml
#   - GitHub Code Scanning: Security tab in GitHub UI
#
# ============================================================================

# Auto-discovery: Empty rules array means Semgrep will scan all rules in
# .semgrep/rules/ directory. This provides consistency across all contexts
# (local, PR, main) while allowing different enforcement policies.
rules: []

# ============================================================================
# Reporting Configuration
# ============================================================================
#
# Main branch scans generate comprehensive reports for:
#
# 1. GitHub Code Scanning (SARIF)
#    - Uploaded to GitHub Security tab
#    - Provides historical trend analysis
#    - Integrates with Dependabot and other security tools
#    - Command: --sarif --output findings.sarif
#
# 2. Metrics Collection (JSON)
#    - Used for dashboards and KPIs
#    - Tracks rule effectiveness
#    - Monitors technical debt trends
#    - Command: --json --output findings.json
#
# 3. Human-Readable Reports (Text)
#    - Archived as CI artifacts
#    - Used for manual review
#    - Command: --text --output findings.txt
#
# ============================================================================
# Rule Execution (Same as PR Context)
# ============================================================================
#
# All rules from .semgrep/rules/ are executed with the same severity levels
# as PR context. See .semgrep/config/pr.yaml for complete rule matrix.
#
# Key Differences from PR Context:
#   - SARIF output is generated and uploaded to GitHub
#   - Metrics are collected for trend analysis
#   - Results are archived for historical comparison
#   - Runs on every push to main, not just on PR creation
#
# ============================================================================
# Performance Targets
# ============================================================================
#
# Target: < 3 minutes for full codebase scan including report generation
# Actual: ~1.5 seconds scan time + ~0.5 seconds report generation
#
# Monitoring:
#   - GitHub Actions workflow duration
#   - Semgrep metrics output (--metrics)
#   - CI/CD pipeline analytics
#
# ============================================================================
# Metrics Collected
# ============================================================================
#
# The following metrics are tracked on main branch:
#
# 1. Finding Counts by Severity
#    - ERROR: Critical issues blocking merge
#    - WARNING: Important issues for review
#    - INFO: Informational suggestions
#
# 2. Finding Counts by Category
#    - Security: Vulnerabilities and bad practices
#    - Domain: Business logic and immutability
#    - Architecture: Hexagonal architecture violations
#    - Performance: Potential bottlenecks
#    - Quality: Code quality and style
#
# 3. Trend Analysis
#    - New findings introduced
#    - Findings resolved
#    - Net change in technical debt
#
# 4. Rule Effectiveness
#    - Rules with most findings
#    - Rules with no findings (candidates for removal)
#    - False positive rate (via exception annotations)
#
# ============================================================================
# Exception Handling (Same as PR Context)
# ============================================================================
#
# Developers can suppress findings using nosemgrep annotations.
# All exceptions MUST include justification.
#
# See: .semgrep/docs/exception-guidelines.md
#
# Exception metrics are tracked:
#   - Total exceptions by category
#   - Exceptions in critical domains (presupuesto, estimacion)
#   - Exceptions without justification (policy violation)
#
# ============================================================================
