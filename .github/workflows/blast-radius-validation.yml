name: Blast Radius Validation

on:
  pull_request:
    branches: [main, develop]
    paths:
      - 'backend/**'
      - 'domain/**'
      - 'infrastructure/**'
      - 'tools/blast-radius-validator/**'
  push:
    branches: [main, develop]
    paths:
      - 'backend/**'
      - 'domain/**'
      - 'infrastructure/**'

jobs:
  validate-blast-radius:
    name: Validate Blast Radius
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'maven'

      - name: Ensure mvnw is executable
        working-directory: tools/blast-radius-validator
        run: |
          chmod +x mvnw

      - name: Build blast radius validator
        working-directory: tools/blast-radius-validator
        run: |
          ./mvnw clean package -DskipTests

      - name: Locate blast radius validator JAR
        id: locate-jar
        working-directory: tools/blast-radius-validator
        run: |
          JAR_PATH=$(ls target/*blast-radius-validator*.jar | head -n 1)
          echo "jar=$JAR_PATH" >> $GITHUB_OUTPUT

      - name: Validate blast radius
        id: validate
        run: |
          java -jar tools/blast-radius-validator/${{ steps.locate-jar.outputs.jar }} . \
            --no-colors

      - name: Validation passed
        run: |
          echo "âœ… Blast radius validation passed"
          echo "All staged changes are within the configured limits."

