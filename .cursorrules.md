# BudgetPro Governing Rules for AI and Development

#

# This file defines the mandatory guidelines that govern how the codebase

# must be modified and how AI assistants should operate when interacting

# with the repository. It complements the AXIOM configuration and reflects

# recent hardening of the Naming, Boundary, State¬†Machine and Semgrep

# validators. All changes and suggestions must comply with the rules

# defined here.

## ‚öñÔ∏è LEY SUPREMA DE GOBERNANZA (AXIOM-SAFE)

1. **CONSULTA OBLIGATORIA DEL HANDBOOK**: Antes de cualquier acci√≥n, el asistente DEBE leer `.budgetpro/handbook/AXIOM_SAFE_OPERATIONS.md`. Es el or√°culo de decisiones para MODES, RISK y NAMING.

2. **DIAGN√ìSTICO DE APERTURA (MANDATORIO)**:
   - No se permite c√≥digo sin antes imprimir en el chat el **DIAGN√ìSTICO INICIAL**:
     ```
     üìä [MODO: 0/1/2] | [RIESGO: LOW/MID/HIGH] | [BRANCH: tipo/sistema-desc]
     Estado: [Resumen corto del repo seg√∫n ./axiom.sh --status]
     ```

3. **JERARQU√çA DE ALERTAS**:
   - **[BLOCKING]**: Detenci√≥n absoluta. Prohibido el uso de `--no-verify` a menos que se documente un incidente en `.budgetpro/handbook/INCIDENT_LOGS.md` bajo MODE_0.
   - **[WARNING]**: Los avisos de 'LEAK' o 'SECRET' se tratan como BLOCKING. Los de 'Null-Safety' deben corregirse en el batch actual.

4. **EST√ÅNDAR DE TRABAJO AT√ìMICO**:
   - **1 Prop√≥sito = 1 Commit**.
   - Si un cambio excede el **Blast Radius (10 archivos)**, el asistente DEBE realizar un `git reset` y dividir el trabajo en Batches Tem√°ticos (ej: batch_logic, batch_tests).

5. **LIMPIEZA DE C√ìDIGO (ANTI-DIRTY)**:
   - Prohibido eliminar `System.out` o `printStackTrace` sin reemplazarlos por una implementaci√≥n formal de `Logger` (SLF4J/java.util.logging).
   - Todo m√©todo p√∫blico nuevo o modificado DEBE incluir validaci√≥n `Objects.requireNonNull()`.

6. **PROTECCI√ìN DE ARCHIVOS DE GOBIERNO**:
   - El asistente tiene PROHIBIDO modificar `.cursorrules.md` o `axiom.config.yaml` sin autorizaci√≥n expl√≠cita.
   - Cualquier archivo llamado `.cursorrules` (sin extensi√≥n) es considerado CORRUPTO y debe ser purgado seg√∫n SOP-02.

supreme_rule:

# AXIOM is the ultimate authority. The domain layer is sacrosanct and

# must remain free of dependencies on frameworks or upper layers.

- "AXIOM IS LAW: all code changes must pass `./axiom.sh --dry-run` before execution and respect the hexagonal architecture."
- "Never modify the domain layer (`com.budgetpro.domain`) to fix errors in the application or infrastructure layers."

hands_clean:

# Protocol for handling large compilation failures (>50 errors).

- "Extract only the first 20 errors to identify the root cause before editing any files."
- "Prioritise correcting imports or calls in Application/Infrastructure; do not change Domain to satisfy upper-layer errors."
- "If the root cause truly resides in Domain, stop and create an `implementation_plan.md` for approval before proceeding."
- "After each individual change, run `./axiom.sh --dry-run` to validate before making the next change."

initialization:

- "Before writing any code, always run `./axiom.sh --dry-run` to validate the current state."
- "Verify that there are no pending AXIOM violations."
- "Consult `.budgetpro/axiom.config.yaml` and this file (`.cursorrules`) to understand the active rules."

architecture:

# Hexagonal architecture enforcement.

- "Domain ‚Üê Application ‚Üê Infrastructure: dependencies flow inward."
- "Domain depends on nothing; Application depends only on Domain; Infrastructure depends on both."
- "Use Naming, Boundary, State¬†Machine and Semgrep validators to verify adherence to these principles."

blast_radius:

# Limits on the number of files modified per commit in sensitive areas.

red: - "domain/finanzas/presupuesto: max 1 file per commit" - "domain/finanzas/estimacion: max 1 file per commit" - "domain/valueobjects: max 1 file per commit" - "domain/entities: max 1 file per commit"
yellow: - "infrastructure/persistence: max 3 files per commit"
green: - "application: max 10 files per commit" - "infrastructure/web: max 10 files per commit" - "tests: max 10 files per commit"

ai_assistant:

# Mandatory checks for AI assistants when preparing changes.

- "Check that the blast radius limits are respected for the proposed change."
- "Confirm that no secrets or sensitive data are exposed."
- "Ensure no lazy code patterns remain (e.g., methods returning null without validation)."
- "Verify adherence to the hexagonal architecture and domain isolation."
- "Run Naming, Boundary, State¬†Machine and Semgrep validators as part of the validation pipeline."
- "Classify each proposed change as LOW, MID or HIGH risk and ensure the appropriate operating mode is engaged."

bypass_prohibition:

# Rules forbidding bypasses of governance and validation.

- "Never modify protected configuration files (`axiom.config.yaml`, `.cursorrules`, `boundary-rules.json`, `state-machine-rules.yml`, Semgrep rule files) to circumvent validations."
- "If a change is blocked by AXIOM or governance, split the work into smaller commits or request explicit approval from the project owner."
- "Do not use command-line flags such as `--no-verify` or alter blast radius limits to force a commit through."

modes:
MODE_0:
description: "Emergency lockdown: project does not compile or more than 50 compilation errors."
allowed: - "Fix broken imports, remove duplicate methods or comment invalid code solely to restore compilation."
forbidden: - "Adding features, refactoring or changing business logic."
MODE_1:
description: "Stabilization: build compiles but tests fail or there are many warnings."
allowed: - "Grouped changes addressing a single root cause without touching domain logic."
forbidden: - "Changing domain semantics or introducing new business decisions."
MODE_2:
description: "Normal operation: CI is green and there is no critical debt."
allowed: - "One cause per commit; changes must be atomic and compliant with all rules."

risk_classification:
low:
description: "Mechanical fixes such as removing duplicates, adjusting imports or visibility, or trivial code formatting."
behaviour: "The IDE may execute these automatically but must inform the user afterwards."
mid:
description: "Changes that adjust control flow, tweak service logic or reorganise internals without affecting domain."
behaviour: "The IDE must propose the plan and wait for explicit user approval."
high:
description: "Any change involving `com.budgetpro.domain`, enums, state machines, public contracts or business semantics."
behaviour: "The IDE must generate an `analysis_plan.md` and await explicit approval from the user before execution."

atomicity:

- "Each commit must pursue a single objective with a single root cause and be fully reversible."
- "Do not mix corrections with enhancements or touch the domain without justification."

big_bang:

- "Large changes modifying many files must pass through MODE_0 or MODE_1."
- "Never modify more files than allowed by the blast radius without declaring the appropriate operating mode and validating after each batch."

protected_files:

- "axiom.config.yaml"
- ".cursorrules"
- ".domain-validator.yaml"
- "boundary-rules.json"
- "state-machine-rules.yml"
- ".semgrep/rules/\*"
- "Naming validator configuration files (if present)"

updates:

- "This file must remain consistent with the governance document and tool configurations."
- "Any updates require approval from project governance and must be accompanied by documentation explaining the changes."

## üîç PROTOCOLO DE LECTURA DE TERMINAL (OBLIGATORIO)

1. **PROHIBIDO IGNORAR WARNINGS**: Aunque el commit sea exitoso, si AXIOM imprime un `[WARNING]`, el asistente DEBE leerlo. Si el warning contiene "LEAK", "SECRET", o "SECURITY", DEBES hacer un rollback del commit inmediatamente y corregirlo.
2. **AN√ÅLISIS DE SUGERENCIAS**: Ante un `[BLOCKING]`, es MANDATORIO leer la secci√≥n `Sugerencia:` que provee AXIOM. No intentes adivinar la soluci√≥n; aplica la sugerencia t√©cnica impresa.
3. **VERIFICACI√ìN DE JAR**: Si el terminal indica `Domain validator JAR not found`, no intentes validar el dominio hasta ejecutar `cd tools/domain-validator && ./mvnw package`.

## üõë PROTOCOLO DE APERTURA DE JORNADA (MANDATORIO)

Antes de proponer o ejecutar CUALQUIER cambio, el asistente DEBE realizar un diagn√≥stico y declarar su estado en el chat con el siguiente formato:

---

üìä **DIAGN√ìSTICO INICIAL AXIOM**

- **ESTADO DEL REPOSITORIO**: (Ej: 54 archivos en stage, errores de compilaci√≥n detectados)
- **MODO OPERATIVO SELECCIONADO**: [MODE_0 | MODE_1 | MODE_2] (Justificar seg√∫n ./axiom.sh --status)
- **CLASIFICACI√ìN DE RIESGO**: [LOW | MID | HIGH] (Justificar seg√∫n la zona de impacto)
- **PLAN DE ACCI√ìN**: (Breve descripci√≥n de pasos)

---

**REGLA DE BLOQUEO**: Si el asistente no presenta este diagn√≥stico, el USUARIO tiene prohibido aceptar cualquier sugerencia.
